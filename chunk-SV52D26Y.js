import{Eb as g,I as l,N as c,a as t,b as n,ba as r,ca as u,kb as d}from"./chunk-UZHONRYK.js";var m=class o{persistence=c(g);auditsSignal=r([]);findingsSignal=r([]);constructor(){let i=this.persistence.loadData();i?.audits?this.auditsSignal.set(i.audits.map(e=>n(t({},e),{teamId:e.id==="1"?e.teamId||"1":e.teamId,startDate:new Date(e.startDate)}))):this.auditsSignal.set([{id:"1",code:"AUD-2024-001",teamId:"1",title:"Auditoria de Conformidade na Merenda Escolar",department:"Secretaria de Educa\xE7\xE3o",startDate:new Date("2024-01-10"),status:"execucao",riskLevel:"alto",auditorId:"user-1",objectives:[],planningMatrix:[{question:"A aquisi\xE7\xE3o dos g\xEAneros aliment\xEDcios seguiu os ditames da Lei 14.133/2021?",informationRequired:"Processos licitat\xF3rios, notas fiscais, contratos.",sourceOfInformation:"Sistema de Compras, Arquivo Morto",procedure:"An\xE1lise Documental",procedureDetail:"Verificar se houve pesquisa de pre\xE7os e publicidade adequada.",objects:"Contrato 123/2023",responsibleMember:"Jo\xE3o Silva",period:"10/01 a 15/01",possibleFindings:"Sobrepre\xE7o, falta de publicidade."}],risks:[{process:"Aquisi\xE7\xE3o de Alimentos",reference:"R1",event:"Compra de alimentos perec\xEDveis em excesso",causes:"Falta de planejamento",consequences:"Desperd\xEDcio",probability:"muito_alta",inherentRiskLevel:"extremo",controlsIdentified:"Nenhum controle formal identificado",controlEffectiveness:"fraco",residualRiskLevel:"critico",relevance:"Alto impacto financeiro e social",viability:"normal",includeInMatrix:"Sim",auditQuestion:"Os quantitativos adquiridos foram baseados em estudos t\xE9cnicos de consumo?"}]}]),i?.findings?this.findingsSignal.set(i.findings):this.findingsSignal.set([{id:"1",auditId:"1",title:"Alimentos vencidos no estoque",description:"Foram encontrados 50kg de arroz vencidos no dep\xF3sito central.",criteria:"Resolu\xE7\xE3o ANVISA RDC n\xBA 216/2004",condition:"Produtos com data de validade expirada.",objects:"Dep\xF3sito Central, Estoque de Arroz",evidence:"Fotos datadas de 10/01/2024 e relat\xF3rio de inspe\xE7\xE3o.",cause:"Falha no controle PEPS (Primeiro que Entra, Primeiro que Sai).",effect:"Risco \xE0 sa\xFAde dos alunos e desperd\xEDcio de recursos p\xFAblicos.",recommendation:"Implementar controle rigoroso de validade e descartar lote vencido.",severity:"alta",status:"aberto"}]),u(()=>{let e=this.persistence.loadData()||{};this.persistence.saveData(n(t({},e),{audits:this.auditsSignal(),findings:this.findingsSignal()}))})}audits=this.auditsSignal.asReadonly();activeAuditsCount=d(()=>this.auditsSignal().filter(i=>i.status==="execucao"||i.status==="planejamento").length);stats=d(()=>{let i=this.auditsSignal();return{total:i.length,highRisk:i.filter(e=>e.riskLevel==="alto").length,completed:i.filter(e=>e.status==="concluida").length}});addAudit(i){let e=n(t({},i),{id:crypto.randomUUID()});this.auditsSignal.update(a=>[e,...a])}updateAudit(i,e){this.auditsSignal.update(a=>a.map(s=>s.id===i?t(t({},s),e):s))}getAuditById(i){return d(()=>this.auditsSignal().find(e=>e.id===i))}findings=this.findingsSignal.asReadonly();getFindingsByAuditId(i){return d(()=>this.findingsSignal().filter(e=>e.auditId===i))}addFinding(i){let e=n(t({},i),{id:crypto.randomUUID()});this.findingsSignal.update(a=>[...a,e])}updateFinding(i,e){this.findingsSignal.update(a=>a.map(s=>s.id===i?t(t({},s),e):s))}getAllData(){return{audits:this.auditsSignal(),findings:this.findingsSignal(),teams:this.persistence.loadData()?.teams||[]}}importAllData(i){i.audits&&this.auditsSignal.set(i.audits),i.findings&&this.findingsSignal.set(i.findings),this.persistence.saveData(i),window.location.reload()}static \u0275fac=function(e){return new(e||o)};static \u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})};export{m as a};
